name: Algolia DocSearch Crawl

on:
  # Trigger after deploy workflow completes
  workflow_run:
    workflows: ["Deploy to GitHub Pages"]
    types:
      - completed
    branches:
      - master
  # Allow manual trigger
  workflow_dispatch:

jobs:
  crawl:
    runs-on: ubuntu-latest
    # Only run if deploy was successful (or manual trigger)
    if: ${{ github.event_name == 'workflow_dispatch' || github.event.workflow_run.conclusion == 'success' }}
    steps:
      - uses: actions/checkout@v4

      - name: Run Algolia Crawler
        uses: algolia/algoliasearch-crawler-github-actions@v1
        with:
          crawler-user-id: ${{ secrets.ALGOLIA_CRAWLER_USER_ID }}
          crawler-api-key: ${{ secrets.ALGOLIA_CRAWLER_API_KEY }}
          algolia-app-id: ${{ secrets.ALGOLIA_APP_ID }}
          algolia-api-key: ${{ secrets.ALGOLIA_ADMIN_KEY }}
          site-url: 'https://dpsystems-dev.github.io/knowledgebase/'
          override-config: true
