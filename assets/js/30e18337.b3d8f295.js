"use strict";(globalThis.webpackChunkabm_web_portal_docs=globalThis.webpackChunkabm_web_portal_docs||[]).push([[5585],{7024(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"stripe-integration/overview","title":"How Stripe Payments Work","description":"Overview of the Stripe payment integration in ABM Service Web Portal - understand the three main components and how payments flow through the system.","source":"@site/versioned_docs/version-1.2/stripe-integration/overview.md","sourceDirName":"stripe-integration","slug":"/stripe-integration/overview","permalink":"/knowledgebase/stripe-integration/overview","draft":false,"unlisted":false,"tags":[],"version":"1.2","sidebarPosition":1,"frontMatter":{"title":"How Stripe Payments Work","sidebar_position":1,"description":"Overview of the Stripe payment integration in ABM Service Web Portal - understand the three main components and how payments flow through the system.","keywords":["stripe","payments","overview","architecture","integration"]},"sidebar":"docsSidebar","previous":{"title":"Troubleshooting","permalink":"/knowledgebase/installation/troubleshooting"},"next":{"title":"How to Request a Payment (ABM Users)","permalink":"/knowledgebase/stripe-integration/user-guides/how-to-request-payment"}}');var r=n(4848),i=n(8453);const o={title:"How Stripe Payments Work",sidebar_position:1,description:"Overview of the Stripe payment integration in ABM Service Web Portal - understand the three main components and how payments flow through the system.",keywords:["stripe","payments","overview","architecture","integration"]},a="How Stripe Payments Work",l={},c=[{value:"How Do Payments Flow Through the System?",id:"how-do-payments-flow-through-the-system",level:2},{value:"What Are the Two User Types?",id:"what-are-the-two-user-types",level:2},{value:"Why Are There Different Success URLs?",id:"why-are-there-different-success-urls",level:3},{value:"How Do I Know Who Created a Payment?",id:"how-do-i-know-who-created-a-payment",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"how-stripe-payments-work",children:"How Stripe Payments Work"})}),"\n",(0,r.jsx)(t.p,{children:"The Stripe payment system allows customers to pay via credit/debit card. There are three main components working together:"}),"\n",(0,r.jsx)(t.mermaid,{value:'flowchart TB\n    subgraph OurSystem["Our System"]\n        A[ABM Portal]\n        B[(StripePayments Table)]\n    end\n    subgraph External["External Services"]\n        C[Stripe Payment Processor]\n        D[Stripe Events / Webhooks]\n        E[Customer\'s Bank]\n    end\n\n    A <--\x3e|API calls| C\n    C <--\x3e|Card processing| E\n    A --\x3e|Store payment data| B\n    D --\x3e|Notifications| A'}),"\n",(0,r.jsx)(t.h2,{id:"how-do-payments-flow-through-the-system",children:"How Do Payments Flow Through the System?"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"What you'll learn:"})," The six steps that every payment goes through, from request to completion."]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"User creates"})," a payment request in ABM Portal"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Portal creates"})," a Stripe checkout session"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Customer is redirected"})," to Stripe's secure payment page"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Customer enters"})," card details and pays"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Stripe notifies"})," our system (via webhook) when payment completes"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Portal updates"})," the StripePayments table"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"what-are-the-two-user-types",children:"What Are the Two User Types?"}),"\n",(0,r.jsx)(t.p,{children:"Payments can be initiated by two types of users with different flows:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Aspect"}),(0,r.jsx)(t.th,{children:"ABM Users"}),(0,r.jsx)(t.th,{children:"External Users"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Who"}),(0,r.jsx)(t.td,{children:"Internal staff"}),(0,r.jsx)(t.td,{children:"Customers with portal access"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"SourceRole"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"abm"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"external"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Success URL"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"/payments/customer-result"})," (public)"]}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"/payments/result"})," (authenticated)"]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"QR Code"}),(0,r.jsx)(t.td,{children:"Yes - share with customer"}),(0,r.jsx)(t.td,{children:"No - pays directly"})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"why-are-there-different-success-urls",children:"Why Are There Different Success URLs?"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"ABM Users"})," initiate payments on behalf of customers. The customer receives a QR code or link to pay. When they complete payment, they land on a public result page (",(0,r.jsx)(t.code,{children:"/payments/customer-result"}),") that doesn't require login."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"External Users"})," are customers logged into the portal who pay their own invoices. After payment, they return to an authenticated result page (",(0,r.jsx)(t.code,{children:"/payments/result"}),") within their portal session."]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["The public customer result page does ",(0,r.jsx)(t.strong,{children:"not"})," mark a payment as ",(0,r.jsx)(t.code,{children:"cancelled"}),". It only polls status and shows the result. If the customer cancels the Stripe checkout, the payment stays ",(0,r.jsx)(t.code,{children:"pending"})," until it expires or completes. Only the authenticated result flow (",(0,r.jsx)(t.code,{children:"/payments/result"}),") calls the cancel API to set ",(0,r.jsx)(t.code,{children:"cancelled"}),"."]})}),"\n",(0,r.jsx)(t.h2,{id:"how-do-i-know-who-created-a-payment",children:"How Do I Know Who Created a Payment?"}),"\n",(0,r.jsxs)(t.p,{children:["Check the ",(0,r.jsx)(t.code,{children:"SourceRole"})," column in the database:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"abm"})," = Created by internal ABM staff"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"external"})," = Created by external customer directly"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"./user-guides/how-to-request-payment",children:"How to Request a Payment (ABM Users)"})," - Step-by-step guide for ABM staff"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"./user-guides/how-to-make-payment",children:"How to Make a Payment (External Users)"})," - Guide for customers"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"./technical-reference/database-schema",children:"Database Schema Reference"})," - StripePayments table details"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"./technical-reference/payment-status-lifecycle",children:"Payment Status Lifecycle"})," - Status definitions and transitions"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,t,n){n.d(t,{R:()=>o,x:()=>a});var s=n(6540);const r={},i=s.createContext(r);function o(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);