"use strict";(globalThis.webpackChunkabm_web_portal_docs=globalThis.webpackChunkabm_web_portal_docs||[]).push([[2487],{8453(e,n,s){s.d(n,{R:()=>c,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function c(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(r.Provider,{value:n},e.children)}},9373(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"stripe-integration/troubleshooting/common-issues","title":"What Happens When a Payment Goes Wrong?","description":"Edge cases and how the system handles them - browser crashes, webhook failures, abandoned checkouts, declined cards, and more.","source":"@site/versioned_docs/version-1.2/stripe-integration/troubleshooting/common-issues.md","sourceDirName":"stripe-integration/troubleshooting","slug":"/stripe-integration/troubleshooting/common-issues","permalink":"/knowledgebase/stripe-integration/troubleshooting/common-issues","draft":false,"unlisted":false,"tags":[],"version":"1.2","sidebarPosition":1,"frontMatter":{"title":"What Happens When a Payment Goes Wrong?","sidebar_position":1,"description":"Edge cases and how the system handles them - browser crashes, webhook failures, abandoned checkouts, declined cards, and more.","keywords":["troubleshooting","edge cases","browser crash","webhook","abandoned","declined"]},"sidebar":"docsSidebar","previous":{"title":"Production Checklist","permalink":"/knowledgebase/stripe-integration/production-checklist"},"next":{"title":"Why Is My Payment Stuck on Pending?","permalink":"/knowledgebase/stripe-integration/troubleshooting/payment-stuck-pending"}}');var i=s(4848),r=s(8453);const c={title:"What Happens When a Payment Goes Wrong?",sidebar_position:1,description:"Edge cases and how the system handles them - browser crashes, webhook failures, abandoned checkouts, declined cards, and more.",keywords:["troubleshooting","edge cases","browser crash","webhook","abandoned","declined"]},o="What Happens When a Payment Goes Wrong?",a={},d=[{value:"What Happens If the Customer&#39;s Browser Crashes During Payment?",id:"what-happens-if-the-customers-browser-crashes-during-payment",level:2},{value:"What Happens If the Webhook Fails to Arrive?",id:"what-happens-if-the-webhook-fails-to-arrive",level:2},{value:"What Happens If the Customer Abandons Checkout?",id:"what-happens-if-the-customer-abandons-checkout",level:2},{value:"What Happens If the Customer Clicks Cancel?",id:"what-happens-if-the-customer-clicks-cancel",level:2},{value:"What Happens If the Card Is Declined?",id:"what-happens-if-the-card-is-declined",level:2},{value:"What Happens If the User Clicks Multiple Times?",id:"what-happens-if-the-user-clicks-multiple-times",level:2},{value:"What Happens If Payment Gets Stuck in CREATED Status?",id:"what-happens-if-payment-gets-stuck-in-created-status",level:2},{value:"What Happens With Invalid Payment Amounts?",id:"what-happens-with-invalid-payment-amounts",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"what-happens-when-a-payment-goes-wrong",children:"What Happens When a Payment Goes Wrong?"})}),"\n",(0,i.jsx)(n.p,{children:"This guide covers common edge cases and how the system handles them. Understanding these scenarios helps support teams quickly diagnose and resolve payment issues."}),"\n",(0,i.jsx)(n.h2,{id:"what-happens-if-the-customers-browser-crashes-during-payment",children:"What Happens If the Customer's Browser Crashes During Payment?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario:"})," Customer enters card details, clicks Pay, but their browser crashes before seeing the result."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"The payment may have succeeded on Stripe's side"}),"\n",(0,i.jsx)(n.li,{children:"Customer doesn't see the success page"}),"\n",(0,i.jsxs)(n.li,{children:["Our webhook still receives the ",(0,i.jsx)(n.code,{children:"checkout.session.completed"})," event"]}),"\n",(0,i.jsxs)(n.li,{children:["Payment status is updated to ",(0,i.jsx)(n.code,{children:"completed"})," via webhook"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to verify:"})," Check if Status = ",(0,i.jsx)(n.code,{children:"completed"})," and LatestStatusUpdateSource = ",(0,i.jsx)(n.code,{children:"webhook"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Resolution:"})," Payment was successful. Customer can view receipt via StripeReceiptUrl."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-happens-if-the-webhook-fails-to-arrive",children:"What Happens If the Webhook Fails to Arrive?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario:"})," Network issues prevent Stripe's webhook from reaching our server."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Payment succeeds on Stripe"}),"\n",(0,i.jsx)(n.li,{children:"Webhook doesn't arrive (or fails to process)"}),"\n",(0,i.jsxs)(n.li,{children:["Status remains ",(0,i.jsx)(n.code,{children:"pending"})]}),"\n",(0,i.jsx)(n.li,{children:"Background cron job runs every 5 minutes"}),"\n",(0,i.jsx)(n.li,{children:"Cron checks Stripe for actual payment status"}),"\n",(0,i.jsxs)(n.li,{children:["Status updated to ",(0,i.jsx)(n.code,{children:"completed"})," by cron"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to verify:"})," LatestStatusUpdateSource = ",(0,i.jsx)(n.code,{children:"cron"})," instead of ",(0,i.jsx)(n.code,{children:"webhook"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Timeframe:"})," Payment will be detected within 5 minutes max."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-happens-if-the-customer-abandons-checkout",children:"What Happens If the Customer Abandons Checkout?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario:"})," Customer is redirected to Stripe but never enters card details."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Status stays ",(0,i.jsx)(n.code,{children:"pending"})]}),"\n",(0,i.jsx)(n.li,{children:"After 24 hours, Stripe expires the session"}),"\n",(0,i.jsxs)(n.li,{children:["Stripe sends ",(0,i.jsx)(n.code,{children:"checkout.session.expired"})," webhook"]}),"\n",(0,i.jsxs)(n.li,{children:["Status updated to ",(0,i.jsx)(n.code,{children:"expired"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to verify:"})," Status = ",(0,i.jsx)(n.code,{children:"expired"})," and CompletedAt is NULL."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Resolution:"})," Customer needs to initiate a new payment."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-happens-if-the-customer-clicks-cancel",children:"What Happens If the Customer Clicks Cancel?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario:"})," Customer clicks the cancel link on the Stripe checkout page."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["For ",(0,i.jsx)(n.strong,{children:"external users"})," (authenticated flow), the result page calls the cancel API"]}),"\n",(0,i.jsxs)(n.li,{children:["Status updates to ",(0,i.jsx)(n.code,{children:"cancelled"})]}),"\n",(0,i.jsxs)(n.li,{children:["For ",(0,i.jsx)(n.strong,{children:"ABM public payments"}),", the result page is public and does ",(0,i.jsx)(n.strong,{children:"not"})," cancel"]}),"\n",(0,i.jsxs)(n.li,{children:["Status stays ",(0,i.jsx)(n.code,{children:"pending"})," until Stripe expires it or a webhook marks it ",(0,i.jsx)(n.code,{children:"completed"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to verify:"})," Check ",(0,i.jsx)(n.code,{children:"LatestStatusUpdateSource"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"polling"})," for authenticated cancel"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"public_polling"})," for public status checks (no cancellation)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-happens-if-the-card-is-declined",children:"What Happens If the Card Is Declined?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario:"})," Customer's card has insufficient funds or is blocked."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Customer enters card details and clicks Pay"}),"\n",(0,i.jsx)(n.li,{children:"Bank declines the card"}),"\n",(0,i.jsx)(n.li,{children:"Stripe shows error to customer"}),"\n",(0,i.jsx)(n.li,{children:"Customer can try again with different card"}),"\n",(0,i.jsx)(n.li,{children:"If they give up, session eventually expires"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to verify:"})," If they eventually fail out:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Status = ",(0,i.jsx)(n.code,{children:"failed"})," or ",(0,i.jsx)(n.code,{children:"expired"})]}),"\n",(0,i.jsx)(n.li,{children:"FailureReason may contain error message"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Resolution:"})," Customer should try with a different card or contact their bank."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-happens-if-the-user-clicks-multiple-times",children:"What Happens If the User Clicks Multiple Times?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario:"}),' User clicks "Request Payment" but network is slow. They click again.']}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"First request creates payment with IdempotencyKey"}),"\n",(0,i.jsx)(n.li,{children:"Second request arrives with same IdempotencyKey"}),"\n",(0,i.jsx)(n.li,{children:"System detects duplicate via IdempotencyKey"}),"\n",(0,i.jsx)(n.li,{children:"Returns existing StripeSessionUrl instead of creating new payment"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to verify:"})," Only one record exists in StripePayments for that IdempotencyKey."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Protection:"})," The IdempotencyKey prevents duplicate charges."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-happens-if-payment-gets-stuck-in-created-status",children:"What Happens If Payment Gets Stuck in CREATED Status?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario:"})," Payment was created but Stripe session was never set up."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Record created with Status = ",(0,i.jsx)(n.code,{children:"created"})]}),"\n",(0,i.jsx)(n.li,{children:"Error occurred calling Stripe API"}),"\n",(0,i.jsxs)(n.li,{children:["Status never moved to ",(0,i.jsx)(n.code,{children:"pending"})]}),"\n",(0,i.jsx)(n.li,{children:"StripeSessionId is NULL"}),"\n",(0,i.jsxs)(n.li,{children:["After 5 minutes, cron marks it as ",(0,i.jsx)(n.code,{children:"failed"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"How to verify:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Status = ",(0,i.jsx)(n.code,{children:"created"})," (if recent) or ",(0,i.jsx)(n.code,{children:"failed"})," (if >5 min old)"]}),"\n",(0,i.jsx)(n.li,{children:"StripeSessionId is NULL or empty"}),"\n",(0,i.jsx)(n.li,{children:'FailureReason = "Session creation timed out"'}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Resolution:"})," User should try creating a new payment."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-happens-with-invalid-payment-amounts",children:"What Happens With Invalid Payment Amounts?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario:"})," User tries to process an invalid amount."]}),"\n",(0,i.jsxs)(n.p,{children:["Default limits apply unless overridden in Stripe App Configuration (",(0,i.jsx)(n.code,{children:"stripe.minAmount"})," / ",(0,i.jsx)(n.code,{children:"stripe.maxAmount"}),")."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Condition"}),(0,i.jsx)(n.th,{children:"Result"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Amount < configured minimum (default 0.50)"}),(0,i.jsx)(n.td,{children:'Rejected: "Amount must be at least [minAmount]"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Amount > configured maximum (default 50,000)"}),(0,i.jsx)(n.td,{children:'Rejected: "Amount cannot exceed [maxAmount]"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Amount is negative"}),(0,i.jsx)(n.td,{children:"Rejected before payment created"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Amount is 0"}),(0,i.jsx)(n.td,{children:"Rejected before payment created"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to verify:"})," No record created in StripePayments if rejected early."]}),"\n",(0,i.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./payment-stuck-pending",children:"Why Is My Payment Stuck on Pending?"})," - Detailed pending status troubleshooting"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./quick-reference",children:"Quick Reference"})," - Status tables, ID prefixes, timeframes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../technical-reference/payment-status-lifecycle",children:"What Do the Payment Statuses Mean?"})," - Status definitions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);